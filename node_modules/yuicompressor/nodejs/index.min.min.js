var spawn=require("child_process").spawn,fs=require("fs"),path=require("path"),jar,exists=fs.exists||path.exists,lists=fs.readdirSync(path.join(__dirname,"../build"));lists.some(function(b){if(path.extname(b)===".jar"){jar=path.join(__dirname,"../build/",b);return true}});exports.jar=jar;var defaultOptions={charset:"utf8",type:"js"};var validOptions={charset:1,type:1,"line-break":1,nomunge:1,"preserve-semi":1,"disable-optimizations":1};var getString=function(d,f,e){exists(d,function(a){if(a){var b=(path.extname(d)).replace(".","");fs.readFile(d,"utf8",function(h,c){e.type=b;f(h,c,e)})}else{f(null,d,e)}})};var filterOptions=function(b){Object.keys(b).forEach(function(a){if(!validOptions[a]){delete b[a]}});b.type=b.type||"js";b.charset=b.charset||"utf8";return b};var compressString=function(l,m,j){m=filterOptions(m);var n=["-jar",exports.jar],h="",i="",k;Object.keys(m).forEach(function(a){n.push("--"+a);if(m[a]&&m[a]!==true){n.push(m[a])}});k=spawn("java",n,{stdio:["pipe","pipe","pipe"]});k.stdin.write(l);k.stdin.end();k.stdout.on("data",function(a){h+=a});k.stderr.on("data",function(a){i+=a});k.on("exit",function(){var a=null;if(i.indexOf("[ERROR]")>-1){a=i}j(a,h,i)})};var compress=function(d,e,f){if(typeof e==="function"){f=e;e=defaultOptions}getString(d,function(b,a,c){compressString(a,c,f)},e)};exports.compress=compress;exports.compressString=compressString;