(function(b){function a(c){this._$block=b(c.block);this._targetSelector=this._$block.attr("data-bt-target")||this._$block.attr("href");this._getTarget=c.getTarget||null;this._groupName=this._$block.attr("data-bt-group");this._closeBtnSelector=c.closeBtnSelector||".js__bt-close";this._isActive=false;this._animate=c.animate||"simple";this._onOpen=c.onOpen||null;this._onClose=c.onClose||null;this._onAfterOpen=c.onAfterOpen||null;this._onAfterClose=c.onAfterClose||null;this._outerClickClose=c.outerClick||false}a.prototype.init=function(){var e=this.throttle(this.toggler,405);var d=this._clickEvent=this.isIOS()?"touchstart":"click";var c;if(typeof this._getTarget==="function"){c=b(this._getTarget(this._$block,this))}else{c=b(this._targetSelector)}this._$target=c;if((!c||!c.length)&&this._animate!=="none"){return}if(c){c.find(this._closeBtnSelector).on("click",this.hideBlock.bind(this));if(!this.isHidden(c)){this._isActive=true;this._$block.addClass("active")}}this.outerClickListener=this.outerClickListener.bind(this);if(this._outerClickClose){b("body").on(this._clickEvent,this.outerClickListener)}this._$block.on(d,e.bind(this));b("body").on({blockOpening:this.openBlockListener.bind(this),closeGroup:this.closeGroupListener.bind(this)})};a.prototype.toggler=function(f){var c=b(f.target);var d=!!c.closest(this._$target).length;if(!this.isHidden(this._$target)){this._isActive=true}if(this._isActive&&d){return}f.preventDefault();if(this._isActive){this.hideBlock()}else{this.showBlock()}};a.prototype.openBlockListener=function(d,c,f){if(!this._isActive||c.is(this._$block)||f!==this._groupName||f===undefined){return}this.hideBlock()};a.prototype.closeGroupListener=function(c,d){if(!this._isActive||d!==this._groupName||d===undefined){return}this.hideBlock()};a.prototype.outerClickListener=function(f){if(!this._isActive){return}var c=b(f.target);var d=!c.closest(this._$target.add(this._$block)).length;if(!d){return}this.hideBlock()};a.prototype.showBlock=function(){var c=this._$target;var d=this.showCallback.bind(this);this._$block.addClass("active");this._isActive=true;if(typeof this._onOpen==="function"){this._onOpen(this)}this._$block.trigger("blockOpening",[this._$block,this._groupName]);switch(this._animate){case"none":d();break;case"simple":c.show();d();break;case"slide":if(!c.length){d()}else{c.slideDown("normal","linear",d)}break;case"fade":if(!c.length){d()}else{c.fadeIn("normal","linear",d)}break}};a.prototype.showCallback=function(){if(typeof this._onAfterOpen==="function"){this._onAfterOpen(this)}this._$block.trigger("blockOpened",[this._$block,this._groupName]);if(this._outerClickClose){b("body").on(this._clickEvent,this.outerClickListener)}};a.prototype.hideBlock=function(){var c=this._$target;var d=this.hideCallback.bind(this);this._$block.removeClass("active");this._isActive=false;if(typeof this._onClose==="function"){this._onClose(this)}this._$block.trigger("blockClosing",[this._$block,this._groupName]);switch(this._animate){case"none":d();break;case"simple":c.hide();d();break;case"slide":c.slideUp("normal","linear",d);break;case"fade":c.fadeOut("normal","linear",d);break}};a.prototype.hideCallback=function(){if(typeof this._onAfterClose==="function"){this._onAfterClose(this)}this._$block.trigger("blockClosed",[this._$block,this._groupName]);if(this._outerClickClose){b("body").off(this._clickEvent,this.outerClickListener)}};a.prototype.throttle=function(g,d){var e=false,f,c;function h(){if(e){f=arguments;c=this;return}g.apply(this,arguments);e=true;setTimeout(function(){e=false;if(f){h.apply(c,f);f=c=null}},d)}return h};a.prototype.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream};a.prototype.isHidden=function(e){var d=b(e);var c=d.is(":hidden")||d.css("visibility")==="hidden"||+d.css("opacity")===0;return c};b.fn.blockToggler=function(){var c=typeof arguments[0]==="object"?arguments[0]:{};b(this).each(function(){c.block=this;var d=new a(c);d.init()})}})(jQuery);