(function(c){function d(a){this._$block=c(a.block);this._targetSelector=this._$block.attr("data-bt-target")||this._$block.attr("href");this._getTarget=a.getTarget||null;this._groupName=this._$block.attr("data-bt-group");this._closeBtnSelector=a.closeBtnSelector||".js__bt-close";this._isActive=false;this._animate=a.animate||"simple";this._onOpen=a.onOpen||null;this._onClose=a.onClose||null;this._onAfterOpen=a.onAfterOpen||null;this._onAfterClose=a.onAfterClose||null;this._outerClickClose=a.outerClick||false}d.prototype.init=function(){var a=this.throttle(this.toggler,405);var b=this._clickEvent=this.isIOS()?"touchstart":"click";var f;if(typeof this._getTarget==="function"){f=c(this._getTarget(this._$block,this))}else{f=c(this._targetSelector)}this._$target=f;if((!f||!f.length)&&this._animate!=="none"){return}if(f){f.find(this._closeBtnSelector).on("click",this.hideBlock.bind(this));if(!this.isHidden(f)){this._isActive=true;this._$block.addClass("active")}}this.outerClickListener=this.outerClickListener.bind(this);if(this._outerClickClose){c("body").on(this._clickEvent,this.outerClickListener)}this._$block.on(b,a.bind(this));c("body").on({blockOpening:this.openBlockListener.bind(this),closeGroup:this.closeGroupListener.bind(this)})};d.prototype.toggler=function(a){var e=c(a.target);var b=!!e.closest(this._$target).length;if(!this.isHidden(this._$target)){this._isActive=true}if(this._isActive&&b){return}a.preventDefault();if(this._isActive){this.hideBlock()}else{this.showBlock()}};d.prototype.openBlockListener=function(b,e,a){if(!this._isActive||e.is(this._$block)||a!==this._groupName||a===undefined){return}this.hideBlock()};d.prototype.closeGroupListener=function(b,a){if(!this._isActive||a!==this._groupName||a===undefined){return}this.hideBlock()};d.prototype.outerClickListener=function(a){if(!this._isActive){return}var e=c(a.target);var b=!e.closest(this._$target.add(this._$block)).length;if(!b){return}this.hideBlock()};d.prototype.showBlock=function(){var b=this._$target;var a=this.showCallback.bind(this);this._$block.addClass("active");this._isActive=true;if(typeof this._onOpen==="function"){this._onOpen(this)}this._$block.trigger("blockOpening",[this._$block,this._groupName]);switch(this._animate){case"none":a();break;case"simple":b.show();a();break;case"slide":if(!b.length){a()}else{b.slideDown("normal","linear",a)}break;case"fade":if(!b.length){a()}else{b.fadeIn("normal","linear",a)}break}};d.prototype.showCallback=function(){if(typeof this._onAfterOpen==="function"){this._onAfterOpen(this)}this._$block.trigger("blockOpened",[this._$block,this._groupName]);if(this._outerClickClose){c("body").on(this._clickEvent,this.outerClickListener)}};d.prototype.hideBlock=function(){var b=this._$target;var a=this.hideCallback.bind(this);this._$block.removeClass("active");this._isActive=false;if(typeof this._onClose==="function"){this._onClose(this)}this._$block.trigger("blockClosing",[this._$block,this._groupName]);switch(this._animate){case"none":a();break;case"simple":b.hide();a();break;case"slide":b.slideUp("normal","linear",a);break;case"fade":b.fadeOut("normal","linear",a);break}};d.prototype.hideCallback=function(){if(typeof this._onAfterClose==="function"){this._onAfterClose(this)}this._$block.trigger("blockClosed",[this._$block,this._groupName]);if(this._outerClickClose){c("body").off(this._clickEvent,this.outerClickListener)}};d.prototype.throttle=function(b,k){var j=false,i,l;function a(){if(j){i=arguments;l=this;return}b.apply(this,arguments);j=true;setTimeout(function(){j=false;if(i){a.apply(l,i);i=l=null}},k)}return a};d.prototype.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream};d.prototype.isHidden=function(a){var b=c(a);var f=b.is(":hidden")||b.css("visibility")==="hidden"||+b.css("opacity")===0;return f};c.fn.blockToggler=function(){var a=typeof arguments[0]==="object"?arguments[0]:{};c(this).each(function(){a.block=this;var b=new d(a);b.init()})}})(jQuery);